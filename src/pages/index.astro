---
import Layout from "../layouts/layout.astro"
import { supabase } from '../lib/supabase';

const hoy = new Date();
//const hoy = new Date(2026, 2, 16);
const diaSemanaHoy = hoy.getDay(); // 0 (Dom) a 6 (Sab)

const diasHastaMiercoles = (3 - diaSemanaHoy + 7) % 7;

const listaDias = [];
const nombres = ["Domingo", "Lunes", "Martes", "Miércoles", "Jueves", "Viernes", "Sábado"];

for (let i = 0; i <= diasHastaMiercoles; i++) {
  const fechaFila = new Date();
  fechaFila.setDate(hoy.getDate() + i);
  
  listaDias.push({
    fechaIso: fechaFila.toISOString().split('T')[0],
    nombre: nombres[fechaFila.getDay()],
    numero: fechaFila.getDate(),
	mes: fechaFila.toLocaleDateString('es-ES', { month: 'long' })
  });
}

const { data: menu_semana } = await supabase
  .from('menu_semana')
  .select('*')
  .in('fecha', listaDias.map(d => d.fechaIso));



---

<Layout title="Menu semanal">
<div class="ml-5 mr-5 mb-10">
	<h1 class="mb-4 text-4xl font-bold tracking-tight text-heading md:text-5xl lg:text-6xl">Menú de la semana</h1>
	<p class="mb-6 text-lg font-normal text-body lg:text-xl sm:px-16 xl:px-48">Esto es para que pongamos una descripción a nuestra app mi amor.</p>
</div>
{
	listaDias.map(
		(dia) => {
			const comidas = menu_semana?.find(m => m.fecha === dia.fechaIso);
			return (
				<div class="p-5 bg-neutral-secondary-soft border border-default rounded-base mb-4 mr-5 ml-5">
					<time class="text-lg font-semibold text-heading">{dia.nombre} {dia.numero} de {dia.mes}</time>
					<ol class="mt-3 divide-y divide-default">
						<li>
							<div class="text-body mb-5">
								<div class="text-base font-normal mb-1"><span class="font-medium text-heading">{comidas?.comida_1 || 'No asignada'}</span></div>
								<span class="inline-flex items-center bg-neutral-primary-medium border border-default-medium text-heading text-xs font-medium px-1.5 py-0.5 rounded">Comida</span>
							</div>
							<div class="text-body">
								<div class="text-base font-normal mb-1"><span class="font-medium text-heading">{comidas?.comida_2 || 'No asignada'}</span></div>
								<span class="inline-flex items-center bg-neutral-primary-medium border border-default-medium text-heading text-xs font-medium px-1.5 py-0.5 rounded">
									Cena
								</span>
							</div>
						</li>
					</ol>
				</div>
			)
		}
	)
}
</Layout>
